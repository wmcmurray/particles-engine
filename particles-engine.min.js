function Vector(x,y,z){if(x instanceof Vector){y=x.y;z=x.z;x=x.x}this.x=x;this.y=y;this.z=z}Vector.prototype.apply=function(vector,deltaTime,multiplier){var m=typeof deltaTime!="undefined"?deltaTime/1E3:1;var m2=multiplier?multiplier:1;this.x+=vector.x*m*m2;this.y+=vector.y*m*m2;this.z+=vector.z*m*m2;return this};Vector.prototype.multiply=function(amount){this.x*=amount;this.y*=amount;this.z*=amount;return this};
Vector.prototype.divide=function(amount){this.x/=amount;this.y/=amount;this.z/=amount;return this};Vector.prototype.substract=function(amount){this.x-=amount;this.y-=amount;this.z-=amount;return this};Vector.prototype.substractVector=function(vector){this.x-=vector.x;this.y-=vector.y;this.z-=vector.z;return this};Vector.prototype.toString=function(){return"["+Math.round(this.x)+","+Math.round(this.y)+","+Math.round(this.z)+"]"};function Particle(params){this.params={type:"default",src:"",style:{},size:5,mass:1,friction:0.1,lifetime:2,fade:true,rotate:new Vector(0,0,1),inheritVelocity:1,sticky:false,round:false,solid:false};for(var i in params)this.params[i]=params[i];this.parent;this.view;this.pos=new Vector(0,0,0);this.vel=new Vector(0,0,0);this.init()}
Particle.prototype.init=function(){this.view=document.createElement(this.params.src?"img":"div");this.view.className="particle "+this.params.type;this.resize(this.params.size);if(this.params.rotate){var o={};if(this.params.rotate.x)o.rotationX=Math.random()*(360*this.params.rotate.x);if(this.params.rotate.y)o.rotationY=Math.random()*(360*this.params.rotate.y);if(this.params.rotate.z)o.rotationZ=Math.random()*(360*this.params.rotate.z);TweenMax.to(this.view,0,o)}if(this.params.src)this.view.src=this.params.src;
if(this.params.style)jQuery(this.view).css(this.params.style);if(this.params.lifetime){this.bornOn=(new Date).getTime();setTimeout(jQuery.proxy(this.kill,this),this.params.lifetime*1E3)}};Particle.prototype.getLifeSpent=function(){if(this.params.lifetime){var now=(new Date).getTime();var timeSpent=now-this.bornOn;var max=this.params.lifetime*1E3;return timeSpent/max}return false};Particle.prototype.inject=function(parent){this.parent=parent;this.parent.appendChild(this.view);return this};
Particle.prototype.place=function(x,y,z){TweenMax.to(this.view,0,{x:-(jQuery(this.view).outerWidth()*0.5)+x,y:-(jQuery(this.view).outerHeight()*0.5)+y,z:z});this.view.style.zIndex=z;return this};
Particle.prototype.resize=function(size){if(Object.prototype.toString.call(size)==="[object Array]"&&(size[0]&&size[1]))size=size[0]+Math.random()*(size[1]-size[0]);this.params.size=size;this.view.style.width=size+"px";this.view.style.height=size+"px";if(this.params.round)jQuery(this.view).css({borderRadius:this.params.size*0.5+"px"});return this};Particle.prototype.applyForce=function(vector,deltatime,multiplier){this.vel.apply(vector,deltatime,multiplier?multiplier:1);return this};
Particle.prototype.update=function(deltatime){if(this.params.solid)if(this.pos.z<0&&this.vel.z<0)this.vel.z=-this.vel.z*0.75;this.vel.multiply(1-this.params.friction);this.pos.apply(this.vel,deltatime);this.place(this.pos.x,this.pos.y,this.pos.z);if(this.params.lifetime&&this.params.fade)jQuery(this.view).css({opacity:1-this.getLifeSpent()});return this};Particle.prototype.kill=function(){this.parent.removeChild(this.view);this.killed=true;return this};function ParticlesEmitter(parent,params){this.params={relative:false,fixed:false,pps:5,limit:0,particles:{},autoStart:false,from:"center",spread:500};for(var i in params)this.params[i]=params[i];this.lastPosRefreshTime=false;this.parent=parent?jQuery(parent)[0]:document.body;this.container=this.params.relative?jQuery(this.parent)[0]:jQuery(".particles-engine-display")[0];this.pos=new Vector(0,0,0);this.vel=new Vector(0,0,0);this.width=0;this.height=0;this.counter=0;this.loopInterval;this.particles=
new Array;this.init()}ParticlesEmitter.prototype.init=function(){jQuery(this.container).css({transformStyle:"preserve-3d"});this.refreshPos();if(!this.parent.emitters)this.parent.emitters=new Array;this.parent.emitters.push(this);if(this.params.autoStart)this.start()};ParticlesEmitter.prototype.start=function(){this.stop();this.loopInterval=setInterval(jQuery.proxy(this.createParticle,this),1E3/this.params.pps);jQuery(this.parent).addClass("emitting");return this};
ParticlesEmitter.prototype.stop=function(){if(this.loopInterval){clearInterval(this.loopInterval);this.loopInterval=false;jQuery(this.parent).removeClass("emitting")}return this};ParticlesEmitter.prototype.reset=function(){this.counter=0;return this};ParticlesEmitter.prototype.burst=function(amount){if(!this.params.fixed&&!this.params.relative)this.refreshPos();for(var i=0;i<amount;i++)this.createParticle(true);return this};
ParticlesEmitter.prototype.toogle=function(){if(this.loopInterval)this.stop();else this.start();return this};
ParticlesEmitter.prototype.refreshPos=function(){var p=jQuery(this.parent);this.width=p.width();this.height=p.height();if(!this.params.relative){var o=p.offset();this.pos.x=o.left+this.width*0.5;this.pos.y=o.top+this.height*0.5;this.pos.z=0}else{this.pos.x=this.width*0.5;this.pos.y=this.height*0.5;this.pos.z=0}var now=(new Date).getTime();if(this.lastPosRefreshTime){var deltaTime=now-this.lastPosRefreshTime;var pos=new Vector(this.pos);pos.substractVector(this.lastPosRefreshPos);if(deltaTime)pos.multiply(1E3/
deltaTime);this.vel=pos}this.lastPosRefreshTime=now;this.lastPosRefreshPos=new Vector(this.pos)};
ParticlesEmitter.prototype.createParticle=function(ommitPosRefresh){if(this.params.limit&&++this.counter>=this.params.limit){this.stop();return false}else{if(!ommitPosRefresh&&(!this.params.fixed&&!this.params.relative))this.refreshPos();var p=new Particle(this.params.particles);p.pos.apply(this.pos);var values=this.params.from.split(" ");if(values.length<2)switch(values[0]){case "top":case "bottom":values.push(values[0]);values[0]="random";break;case "left":case "right":values.push("random");break;
default:values.push(values[0]);break}if(values[0]=="left")values[0]=0;else if(values[0]=="right")values[0]=1;else if(values[0]=="center")values[0]=0.5;else if(values[0]=="random")values[0]=Math.random();else values[0]=Number(values[0]);if(values[1]=="top")values[1]=0;else if(values[1]=="bottom")values[1]=1;else if(values[1]=="center")values[1]=0.5;else if(values[1]=="random")values[1]=Math.random();else values[1]=Number(values[1]);var newPos=new Vector(this.width*(values[0]-0.5),this.height*(values[1]-
0.5),0);p.pos.apply(newPos);if(p.params.inheritVelocity){var v=new Vector(this.vel);v.multiply(p.params.inheritVelocity);p.vel.apply(v)}if(this.params.spread){var m=this.params.spread;var x=Math.random()*m-m/2;var y=Math.random()*m-m/2;var z=Math.random()*m-m/2;p.vel.apply(new Vector(x,y,z))}p.place(p.pos.x,p.pos.y,p.pos.z);p.inject(this.container);this.particles.push(p);return p}};function ParticlesEngine(params){this.params={fps:30,container:false,gravity:new Vector(0,300,0),perspective:600};for(var i in params)this.params[i]=params[i];this.loopInterval;this.lastFrame;this.emitters=new Array;this.init()}
ParticlesEngine.prototype.init=function(){var particlesContainer=jQuery(".particles-engine-display");if(!particlesContainer.length){this.parent=document.createElement("div");this.parent.className="particles-engine-display";document.body.appendChild(this.parent);TweenMax.to(this.parent,0,{perspective:this.params.perspective});this.resizeScene();this.scrollScene();jQuery(window).resize(jQuery.proxy(this.resizeScene,this));jQuery(window).scroll(jQuery.proxy(this.scrollScene,this))}else this.parent=particlesContainer[0];
this.start()};ParticlesEngine.prototype.resizeScene=function(){jQuery(this.parent).css({height:jQuery("html").height()})};
ParticlesEngine.prototype.scrollScene=function(){var win=jQuery(window);var p=jQuery(this.parent);var scrollTop=win.scrollTop()+win.height()*0.5;var scrollLeft=win.scrollLeft()+win.width()*0.5;var w=p.width();var h=p.height();var perctTop=Math.round(scrollTop*100/h);var perctLeft=Math.round(scrollLeft*100/w);TweenMax.to(this.parent,0,{perspectiveOrigin:perctLeft+"% "+perctTop+"%"})};ParticlesEngine.prototype.getTime=function(){var d=new Date;return d.getTime()};
ParticlesEngine.prototype.start=function(){this.stop();this.lastFrame=this.getTime();this.loopInterval=setInterval(jQuery.proxy(this.render,this),1E3/this.params.fps);this.startEmitters()};ParticlesEngine.prototype.stop=function(){if(this.loopInterval)clearInterval(this.loopInterval);this.stopEmitters()};ParticlesEngine.prototype.startEmitters=function(){for(var i in this.emitters)this.emitters[i].start()};ParticlesEngine.prototype.stopEmitters=function(){for(var i in this.emitters)this.emitters[i].stop()};
ParticlesEngine.prototype.refreshEmitters=function(){for(var i in this.emitters)if(!this.emitters[i].params.fixed)this.emitters[i].refreshPos()};
ParticlesEngine.prototype.render=function(){var now=this.getTime();var deltaTime=now-this.lastFrame;for(var i in this.emitters)for(var j in this.emitters[i].particles){var p=this.emitters[i].particles[j];if(p.killed)delete this.emitters[i].particles[j];else{if(p.params.mass!=0)p.applyForce(this.params.gravity,deltaTime,p.params.mass);if(p.params.sticky){var stickyVel=new Vector(this.emitters[i].pos);stickyVel.substractVector(p.pos).multiply(p.params.sticky);p.applyForce(stickyVel,deltaTime,1)}p.update(deltaTime)}}this.lastFrame=
now};ParticlesEngine.prototype.createEmitter=function(parent,params){var e=new ParticlesEmitter(parent,params);this.emitters.push(e);return e};
